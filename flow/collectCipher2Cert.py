from utils import *
import json
from multiprocessing import Pool


def extractClientEndFromHTTP(data):
    srcPort = extraceFromData(data, ['ConnectInfor', 'port.src'], 'unknown')
    dstPort = extraceFromData(data, ['ConnectInfor', 'port.dst'], 'unknown')
    if srcPort==80:
        return extraceFromData(data,['ConnectInfor','ip.dst'],'unknown'),dstPort
    else:
        return extraceFromData(data, ['ConnectInfor', 'ip.src'], 'unknown'),srcPort


def tlsFeatures(data):
    httplist = filterFileList(basedir, keys=['2018-08-15','HTTP','json'])
    print(httplist)
    connectFiles = filterFileList(basedir, keys=['2018-08-15','Connect','json'])
    ipSet = loadAttackIpSet(httplist)
    if '123.126.113.124' in ipSet:
        ipSet.remove('123.126.113.124')
    connects = readFromIPs(connectFiles,ipSet)
    https = readFromIPs(httplist,ipSet)
    https = filterHttp(https)
    result = []
    for key in https:
        if key in connects:
            result.append({
                'http':https[key],
                'connect':connects[key]
            })
    json.dump(result,open('data/attacks_0815.txt','w+'))
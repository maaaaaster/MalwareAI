import pickle
import codecs
import multiprocessing
import codecs
import pandas as pd
from gensim.models.word2vec import Word2Vec

train_file = "data/train_thread_list.csv"
test_file = "data/test_thread_list.csv"
corpus = []

for filename in [train_file,test_file]:
    df = pd.read_csv(filename)
    print("Segment train title/content...")
    for i,data in df.iterrows():
        if i % 10000 == 0:
            print(i)
        apis = eval(data['apilist'])
        # label = data['label']
        corpus.append(' '.join(apis))


class CorpusData:
    def __init__(self, corpus):
        self.corpus = corpus
    def __iter__(self):
        for doc in self.corpus:
            origin_words = doc.split(' ')
            yield origin_words

print("Train word to vector...")
corpus_data = CorpusData(corpus)
model = Word2Vec(corpus_data, size=16, window=5, min_count=5, workers=15)
model.save('w2v_model_16_w5_m5.save')
print("Train w2v completed.")
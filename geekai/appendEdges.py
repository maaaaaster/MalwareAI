import pandas as pd
import os
from domain import psl,checkip,noHeadDomain

phase1 = 'D:/ai/geek/phase1/trace2_test'


def makeEdges():
    filename = os.path.join(phase1,'trojan_web.csv')
    df = pd.read_csv(filename)
    t = df.groupby('sha1',as_index=False)['url'].count()
    t.columns = ['sha1','urlCnt']
    d = df.groupby('url',as_index=False)['sha1'].count()
    d.columns = ['url','shaCnt']
    df = pd.merge(df,t,on='sha1')
    df = pd.merge(df,d,on='url')

    df = df[(df.urlCnt==1) & (df.shaCnt>1)]
    t.columns = ['sha1','cnt']
    df.to_csv('urlEdge.csv',index=False)
 
def loadEdges():
    df = pd.read_csv('urlEdge.csv')
    edges = []
    urlSet = set()
    def addEdge(data):
        edges.append((data['sha1'],data['url']))
        urlSet.add(data['url'])
    df.apply(addEdge,axis=1)
    return edges,urlSet



if __name__=='__main__':
    makeEdges()
from urllib import parse
import csv
from urllib import parse

from code.tools import *


def extractFiles():
    domain2File = {}
    inf = open(fileMap['web'],encoding='utf-8')
    reader = csv.reader(inf)
    _ = next(reader)
    for data in reader:
        url = data[1]
        vals = url.split('/')
        domain = vals[2].split(':')[0]
        domain = domain2key(domain)
        # if domain.startswith('www.'):
        #     domain = domain[4:]
        if domain not in domain2File:
            domain2File[domain] = set()
        if len(vals)==3:
            continue
        temp_name = vals[-1].split('?')
        if len(temp_name)<2:
            filename = temp_name[0]
        else:
            filename = vals[-1]

        if '%' in filename:
            filename = parse.unquote(filename)

        domain2File[domain].add(filename)

    return domain2File



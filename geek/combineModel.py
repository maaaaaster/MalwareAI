import csv

def loadFromFile(filename):
    shaMap = {}
    inf = open(filename)
    reader = csv.reader(inf)
    head = next(reader)
    classlen = len(head)-1
    for data in reader:
        sha = data[0]
        shaMap[sha] = []
        for i in range(classlen):
            shaMap[sha].append(float(data[1+i]))
    return shaMap

def combine(fileList):
    shaMap = None
    resultMap = {}
    for filename in fileList:
        newMap = loadFromFile(filename)
        if shaMap is None:
            shaMap = newMap
            continue
        for sha,newData in shaMap.items():
            maxIndex = 0
            nowMax = 0
            for index in range(len(newData)):
                shaMap[sha][index] = max(shaMap[sha][index],newData[index])
                if shaMap[sha][index]>nowMax:
                    maxIndex = index
                    nowMax = shaMap[sha][index]
            resultMap[sha] = maxIndex
    with open('data/trace1.csv','w+') as outf:
        for sha,label in resultMap.items():
            if label>0:
                label1 = 1
            else:
                label1 = 0
            outf.write('%s,%d,%d\n'%(sha,label1,label))

if __name__=='__main__':
    data = combine(['/home/malware/geek/data/lstm_output.txt','/home/malware/geek/data/trace1_lgbm_output.txt'])
    # print(list(data.items())[:10])




